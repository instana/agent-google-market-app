applicationApiVersion: v1beta1

properties:
  agent.endpointHost:
    type: string
    title: Instana Service Endpoint
    default: saas-us-west-2.instana.io
  agent.endpointPort:
    type: string
    title: Instana Service Port
    default: "443"
  agent.image.name:
    type: string
    default: $REGISTRY/$APP_NAME:$TAG
    x-google-marketplace:
      type: IMAGE
  agent.key:
    type: string
    title: Instana Agent Key
    description: Instana Agent key, acquire this key from Instana service
  agent.pod.limits.cpu:
    type: string
    title: CPU units allocation limits for the agent pods
    default: "1.5"
  agent.pod.limits.memory:
    type: integer
    title: Memory allocation limits in MiB for the agent pods
    default: 512
  agent.pod.requests.cpu:
    type: string
    title: Requested CPU units allocation for the agent pods
    default: "0.5"
  agent.pod.requests.memory:
    type: integer
    title: Requested memory allocation in MiB for the agent pods
    default: 512
  name:
    type: string
    default: instana-agent
    x-google-marketplace:
      type: NAME
  namespace:
    type: string
    default: instana-agent
    x-google-marketplace:
      type: NAMESPACE
  serviceAccount:
    type: string
    title: Instana Agent Service Account
    x-google-marketplace:
      type: SERVICE_ACCOUNT
      serviceAccount:
        roles:
        - type: ClusterRole
          rulesType: CUSTOM
          rules:
          - nonResourceURLs:
              - "/version"
              - "/healthz"
            verbs: ["get"]
          - apiGroups: ["batch"]
            resources:
              - "jobs"
            verbs: ["get", "list", "watch"]
          - apiGroups: ["extensions"]
            resources:
              - "deployments"
              - "replicasets"
              - "ingresses"
            verbs: ["get", "list", "watch"]
          - apiGroups: ["apps"]
            resources:
              - "deployments"
              - "replicasets"
            verbs: ["get", "list", "watch"]
          - apiGroups: [""]
            resources:
              - "namespaces"
              - "events"
              - "services"
              - "endpoints"
              - "nodes"
              - "pods"
              - "replicationcontrollers"
              - "componentstatuses"
              - "resourcequotas"
            verbs: ["get", "list", "watch"]
          - apiGroups: [""]
            resources:
              - "endpoints"
            verbs: ["create", "update", "patch"]
  zone.name:
    type: string
    title: Instana Zone Name
    description: Name of the cluster that will appear on Instana launch map
required:
- agent.endpointHost
- agent.endpointPort
- agent.image.name
- agent.key
- agent.pod.limits.cpu
- agent.pod.limits.memory
- agent.pod.requests.cpu
- agent.pod.requests.memory
- name
- namespace
- zone.name
x-google-marketplace:
  clusterConstraints:
    resources:
    - replicas: 1
      requests:
        cpu: 500m
        memory: 512Mi
